{% extends 'app/base.html' %}
{% load static %}
{% block title %}Buy Now{% endblock title %}
{% block main-content %}
<div class="container">
  <div class="row mt-3">
    {% if messages %}
    <div class="row">
      <div class="col-sm-6 offset-sm-3 text-center fw-bold">
        {% for message in messages %}
        <h2 class="alert-info">{{message}}</h2>
        {% endfor %}
      </div>
    </div>
    {% endif %}
    <div class="col-sm-6">
      <h4>Order Summary</h4>
      <hr>

      {% if products %}
        {% for product in products %}
              <div class="card mb-2">
                  <div class="card-body bg-dark text-white">
                    <div class="row">

                      <div class="col-sm-3 text-center align-self-center">
                        <img src="{{product.product.product_image.url}}" alt="" srcset="" class="img-fluid img-thumbnail shadow-sm" height="150" width="150"> 
                      </div>
      
                      <div class="col-sm-9">
                        <div>
                          <h5>Product: {{product.product.title}}</h5>
                          <p>Quantity: {{product.quantity}}</p>
                          <!-- product_cost came from Cart Model @property section -->
                          <p class="fw-bold ">Price: {{product.product_cost}} Tk.</p>
                        </div>
                      </div>

                    </div>
                  </div>
              </div>
          {% endfor %}

      {% else %}
        <div class="p-5 text-center bg-dark text-white">
          <h3>No products in your cart!</h3>
        </div>
      {% endif %}
      <p class="mt-2 bg-warning text-center p-2 fw-bold">Total price: {{total}} Tk.</p>
      
      <small>Term and Condition: Lorem ipsum dolor sit amet consectetur adipisicing elit. Mollitia, ullam saepe! Iure optio repellat dolor velit, minus rem. Facilis cumque neque numquam laboriosam, accusantium adipisci nisi nihil in et quis?</small>
    </div>

    <div class="col-sm-5 offset-sm-1">
      <h4>Select Shipping Address <a href="{% url 'address' %}" class="fw-bold btn btn-outline-warning">Add address</a></h4>
      <!-- <a href="{% url 'address' %}" class="btn btn-outline-info">Add address</a> -->

      <hr>

      <form action="{% url 'buy-now' %}">
        {% if address %}
          {% for data in address %}

            <div class="form-check mb-2">
              <input class="form-check-input" type="radio" name="customer_address" id="address_id{{ forloop.counter }}" value="{{data.id}}">
              <!-- id and value is used in input tag of the address radio button -->
              <label class="form-check-label fw-bold" for="address_id{{ forloop.counter }}">Address {{ forloop.counter }} </label>
            </div>

            <div class="card bg-dark text-white">
              <div class="card-body">
                <h5>Name: {{data.name}}</h5>
                <p>Address: {{data.city}},{{data.district}},{{data.zipcode}}</p>
              </div>
            </div>

          {% endfor %}
        {% endif %} 
        <br>
        <div>
              <!-- <button type="submit" class="btn btn-warning mt-2 px-5 fw-bold">Continue</button> -->
               <div id="paypal-button-container"></div>
        </div>
      </form>

    </div>

  </div>
</div>
{% endblock main-content %}

{% block payment-gateway %}
 <script src="https://www.paypal.com/sdk/js?client-id=sb&currency=USD"></script>

 <script>
     // Render the PayPal button into #paypal-button-container
     paypal.Buttons({
      style: {
                layout: 'horizontal'
            },
         // Call your server to set up the transaction
         createOrder: function(data, actions) {
             return actions.order.create({
                 purchase_units: [{
                  amount: {
                    value: '{{total}}'
                  }
                 }]
             });
         },

         // Call your server to finalize the transaction
         onApprove: function(data, actions) {
             return actions.order.capture().then(function(details) {
                 
                 alert('Transaction completed by' + details.payer.name.given_name);

                 // Replace the above to show a success message within this page, e.g.
                 // const element = document.getElementById('paypal-button-container');
                 // element.innerHTML = '';
                 // element.innerHTML = '<h3>Thank you for your payment!</h3>';
                 // Or go to another URL:  actions.redirect('thank_you.html');
             });
         }

     }).render('#paypal-button-container');
 </script>
{% endblock payment-gateway %}

